<!doctype html>
<html>

<head>
  <meta name="generator" content="JSDoc 3.6.3">
  <meta charset="utf-8">
  <title>Source: discord/Shard.js</title>
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Karla:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Noto+Serif:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Inconsolata:500" type="text/css">
  <link href="css/baseline.css" rel="stylesheet">
</head>

<body onload="prettyPrint()">
  <nav id="jsdoc-navbar" role="navigation" class="jsdoc-navbar">
    <div id="jsdoc-navbar-container">
      <div id="jsdoc-navbar-content">
        <a href="index.html" class="jsdoc-navbar-package-name">Home</a>
      </div>
    </div>
  </nav>
  <div id="jsdoc-body-container">
    <div id="jsdoc-content">
      <div id="jsdoc-content-container">
        <div id="jsdoc-banner" role="banner">
        </div>
        <div id="jsdoc-main" role="main">
          <header class="page-header">
            <h1>Source: discord/Shard.js</h1>
          </header>
          <article>
            <pre class="prettyprint linenums"><code>const Websocket &#x3D; require(&#x27;./Websocket&#x27;)

/**
 * Used for connecting and managing separate shards on the Discord bot
 */
class Shard {
  /**
   * Shard interface
   * @param {Client} client Client
   * @param {Number} id Shard ID
   */
  constructor (client, id) {
    this.client &#x3D; client
    this.id &#x3D; id

    this.ws &#x3D; null
    this.ping &#x3D; null
    this.onReady &#x3D; null

    this.dying &#x3D; false

    this.unavailables &#x3D; new Map()

    this.ws &#x3D; new Websocket(this)

    this.promise &#x3D; new Promise((resolve) &#x3D;&gt; {
      this.onReady &#x3D; resolve
    })

    this.promise.then(_ &#x3D;&gt; {
      this.client.log(&#x60;Shard ${this.id} cache settled and ready&#x60;)
    })
  }

  /**
   * Spawns shard
   */
  spawn () {
    this.setup()
    this.ws.setup()
  }

  /**
   * Whether or not the shard is connected
   */
  get connected () {
    return this.ws.opened &amp;amp;&amp;amp; this.ws.connected
  }

  /**
   * Setup shard
   */
  setup () {
    this.ws.on(&#x27;READY&#x27;, (data) &#x3D;&gt; {
      if (data.guilds.length &amp;lt; 1) {
        this.client.emit(&#x27;SHARD_READY&#x27;, this)
        this.unavailables &#x3D; null
        this.onReady()
      }
      this.unavailables &#x3D; new Map()
      data.guilds.forEach(g &#x3D;&gt; { this.unavailables.set(g.id, 1) })
      if (!this.client.user) this.client.user &#x3D; data.user
    })
    this.ws.on(&#x27;GUILD_CREATE&#x27;, (guild) &#x3D;&gt; {
      if (this.unavailables &amp;amp;&amp;amp; this.unavailables.has(guild.id)) {
        this.unavailables.delete(guild.id)

        this.client.internalEvents.GUILD_CREATE(guild)
        if (this.unavailables.size &#x3D;&#x3D;&#x3D; 0) {
          this.client.emit(&#x27;SHARD_READY&#x27;, this)
          this.unavailables &#x3D; null
          this.onReady()
        }
      } else this.client.emit(&#x27;GUILD_CREATE&#x27;, guild)
    })
    this.client.on(&#x27;GUILD_DELETE&#x27;, (guild) &#x3D;&gt; {
      if (this.unavailables &amp;amp;&amp;amp; this.unavailables.has(guild.id)) {
        this.unavailables.delete(guild.id)
        if (this.unavailables.size &#x3D;&#x3D;&#x3D; 0) {
          this.client.emit(&#x27;SHARD_READY&#x27;, this)
          this.unavailables &#x3D; null
          this.onReady()
        }
      }
    })
  }

  /**
   * Sets bot status
   * @param {Object} d Data packet
   */
  setStatus (d) {
    if (!this.connected) return
    this.ws.sendRaw({
      op: 3,
      d
    })
  }

  /**
   * Restarts shard
   */
  restart () {
    this.ws.kill()
  }

  /**
   * Destroys shard
   */
  destroy () {
    this.dying &#x3D; true
    this.ws.kill()
  }
}

module.exports &#x3D; Shard
</code></pre>
          </article>
        </div>
      </div>
      <nav id="jsdoc-toc-nav" role="navigation"></nav>
    </div>
  </div>
  <footer id="jsdoc-footer" class="jsdoc-footer">
    <div id="jsdoc-footer-container">
      <p>
        Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc</a> 3.6.3 on August 21, 2020.
      </p>
    </div>
  </footer>
  <script src="scripts/jquery.min.js"></script>
  <script src="scripts/tree.jquery.js"></script>
  <script src="scripts/prettify.js"></script>
  <script src="scripts/jsdoc-toc.js"></script>
  <script src="scripts/linenumber.js"></script>
  <script src="scripts/scrollanchor.js"></script>
</body>

</html>